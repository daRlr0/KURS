# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫

## –ü—Ä–æ–±–ª–µ–º–∞ 1: Crash –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ ‚ùå

### –û—à–∏–±–∫–∞:
```
java.lang.IllegalArgumentException: This source was already added with the different observer
at androidx.lifecycle.MediatorLiveData.addSource(MediatorLiveData.java:108)
at com.example.cors.viewmodel.CoursesViewModel.switchSource(CoursesViewModel.java:214)
```

### –ü—Ä–∏—á–∏–Ω–∞:
–í –º–µ—Ç–æ–¥–µ `CoursesViewModel.switchSource()` –º—ã –¥–æ–±–∞–≤–ª—è–ª–∏ `errorLiveData` –∏ `loadingLiveData` –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –¥—Ä—É–≥–æ–π Chip).

MediatorLiveData –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∏—Å—Ç–æ—á–Ω–∏–∫ LiveData —Å —Ä–∞–∑–Ω—ã–º–∏ observers.

### –†–µ—à–µ–Ω–∏–µ: ‚úÖ

**–§–∞–π–ª:** `CoursesViewModel.java`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

1. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫:
```java
private LiveData<String> errorLiveDataSource;
private LiveData<Boolean> loadingLiveDataSource;
```

2. –°–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ `observeErrorState()`:
```java
private void observeErrorState() {
    errorLiveDataSource = repository.getErrorLiveData();
    coursesLiveData.addSource(errorLiveDataSource, error -> {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
    });
}
```

3. –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `observeLoadingState()`:
```java
private void observeLoadingState() {
    loadingLiveDataSource = repository.getLoadingLiveData();
    coursesLiveData.addSource(loadingLiveDataSource, isLoading -> {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
    });
}
```

4. –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –≤—ã–∑—ã–≤–∞–µ–º —ç—Ç–∏ –º–µ—Ç–æ–¥—ã **–û–î–ò–ù –†–ê–ó**:
```java
public CoursesViewModel(@NonNull Application application) {
    super(application);
    repository = new CourseRepository(application);
    
    // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ—à–∏–±–∫–∏ –∏ –∑–∞–≥—Ä—É–∑–∫—É –û–î–ò–ù –†–ê–ó
    observeErrorState();
    observeLoadingState();
    
    loadAllCourses();
}
```

5. –£–±—Ä–∞–ª–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑ `switchSource()`:
```java
private void switchSource(LiveData<List<Course>> newSource) {
    // –£–±—Ä–∞–ª–∏: coursesLiveData.addSource(repository.getErrorLiveData(), ...)
    // –¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ newSource
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ–ª—å—à–µ –Ω–µ –∫—Ä–∞—à–∏—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ Chips!

---

## –ü—Ä–æ–±–ª–µ–º–∞ 2: –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ ‚ùå

### –û—à–∏–±–∫–∞:
```
–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: Unable to connect to api.example.com
```

Toast —Å –æ—à–∏–±–∫–æ–π –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –ü—Ä–∏—á–∏–Ω–∞:
Retrofit –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É API (`https://api.example.com/`), –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–æ–π –¥–ª—è –¥–µ–º–æ.

### –†–µ—à–µ–Ω–∏–µ: ‚úÖ

**–§–∞–π–ª:** `CourseRepository.java`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

–û—Ç–∫–ª—é—á–∏–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ demo —Ä–µ–∂–∏–º–µ:

```java
private void refreshCoursesFromApi() {
    // DEMO MODE: API - —ç—Ç–æ –∑–∞–≥–ª—É—à–∫–∞, –Ω–µ –¥–µ–ª–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    loadingLiveData.postValue(false);
    
    // –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∫–æ–¥ –¥–ª—è production:
    /*
    loadingLiveData.postValue(true);
    Call<List<CourseDto>> call = apiService.getCourses();
    call.enqueue(new Callback<List<CourseDto>>() {...});
    */
}
```

**–§–∞–π–ª:** `RetrofitClient.java`

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:

```java
/**
 * ‚ö†Ô∏è DEMO MODE: –≠—Ç–æ –∑–∞–≥–ª—É—à–∫–∞! –†–µ–∞–ª—å–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã.
 * 
 * –í production –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:
 * 1. –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π URL
 * 2. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–æ–¥ –≤ Repository.refreshCoursesFromApi()
 * 3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –≤ —Ñ–æ—Ä–º–∞—Ç–µ CourseDto
 */
private static final String BASE_URL = "https://api.example.com/";
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é offline, –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏ –Ω–µ—Ç!

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏–π

### 1. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å MediatorLiveData ‚úÖ
- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- –ù–µ—Ç —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–æ–∫

### 2. Offline-First –ø–æ–¥—Ö–æ–¥ ‚úÖ
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ Room (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
- –ù–µ—Ç —Ä–∞–∑–¥—Ä–∞–∂–∞—é—â–∏—Ö –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏

### 3. –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Production ‚úÖ
- –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Retrofit –≥–æ—Ç–æ–≤–∞
- –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫–∞–∫ –≤–∫–ª—é—á–∏—Ç—å API

---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è API –≤ Production

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç–µ BASE_URL
**–§–∞–π–ª:** `RetrofitClient.java`
```java
private static final String BASE_URL = "https://api.yourapp.com/";
```

### –®–∞–≥ 2: –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∑–∞–ø—Ä–æ—Å–æ–≤
**–§–∞–π–ª:** `CourseRepository.java` ‚Üí –º–µ—Ç–æ–¥ `refreshCoursesFromApi()`

–†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –±–ª–æ–∫:
```java
loadingLiveData.postValue(true);
Call<List<CourseDto>> call = apiService.getCourses();
call.enqueue(new Callback<List<CourseDto>>() {
    // –≤–µ—Å—å –∫–æ–¥ callback'–æ–≤
});
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç JSON
–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∞—à API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
```json
[
  {
    "id": 1,
    "title": "Android Development",
    "provider": "Udemy",
    "duration": 40,
    "level": "Beginner",
    "image_url": "https://...",
    "description": "..."
  }
]
```

### –®–∞–≥ 4: –î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
–í `AndroidManifest.xml` —É–∂–µ –µ—Å—Ç—å:
```xml
<uses-permission android:name="android.permission.INTERNET" />
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### ‚úÖ –¢–µ—Å—Ç 1: –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ö–ª–∏–∫–∞–π—Ç–µ –Ω–∞ —Ä–∞–∑–Ω—ã–µ Chips (–í—Å–µ ‚Üí –ù–∞—á–∞–ª—å–Ω—ã–π ‚Üí –°—Ä–µ–¥–Ω–∏–π ‚Üí –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï –∫—Ä–∞—à–∏—Ç—Å—è ‚úÖ

### ‚úÖ –¢–µ—Å—Ç 2: –ü–æ–∏—Å–∫
1. –û—Ç–∫—Ä–æ–π—Ç–µ SearchView
2. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç, –∑–∞—Ç–µ–º –æ—á–∏—Å—Ç–∏—Ç–µ
3. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï –∫—Ä–∞—à–∏—Ç—Å—è ‚úÖ

### ‚úÖ –¢–µ—Å—Ç 3: –ó–∞–ø—É—Å–∫
1. –ó–∞–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–µ—Ç Toast'–æ–≤ —Å –æ—à–∏–±–∫–∞–º–∏ —Å–µ—Ç–∏ ‚úÖ

### ‚úÖ –¢–µ—Å—Ç 4: Offline —Ä–µ–∂–∏–º
1. –í—ã–∫–ª—é—á–∏—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ offline ‚úÖ

---

## –†–µ–∑—é–º–µ

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –†–µ—à–µ–Ω–∏–µ |
|----------|--------|---------|
| Crash –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ sources –æ–¥–∏–Ω —Ä–∞–∑ |
| –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –û—Ç–∫–ª—é—á–µ–Ω—ã –∑–∞–ø—Ä–æ—Å—ã –≤ demo |
| –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –•—Ä–∞–Ω–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ sources |
| Toast —Å –æ—à–∏–±–∫–∞–º–∏ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –ù–µ—Ç —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ demo |

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–µ–µ –∏ –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–ë—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
- ‚úÖ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—á–µ–º—É sources –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
- ‚úÖ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∫–∞–∫ –≤–∫–ª—é—á–∏—Ç—å API –≤ production
- ‚úÖ –û–ø–∏—Å–∞–Ω–∏–µ demo —Ä–µ–∂–∏–º–∞
- ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ –æ MediatorLiveData

–ö–æ–¥ —Å—Ç–∞–ª –µ—â–µ –±–æ–ª–µ–µ —É—á–µ–±–Ω—ã–º –∏ –ø–æ–Ω—è—Ç–Ω—ã–º! üìö
